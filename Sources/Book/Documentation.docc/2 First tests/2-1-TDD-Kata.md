# TDD-ката

Чтобы научиться писать тесты нужно поменять привычку того, как вы обычно пишите код. Чтобы отработать навык можно делать специальные упражнения, которые называют TDD-катами. Это простые задачки в которых главная цель научить себя сначала писать тесты, а потом уже писать код. 

> Note: слово «ката» пришло из карате и означает упражнение, которое надо делать регулярно, чтобы привыкнуть к движению. 

## Пример задачи

Типичная ката может быть сформулирована очень просто, например, «напишите расчет очков для игры в боулинг». Нужно разложить правила игры в требования и поочередно выполнить их, получится около 20 тестов. Пример требований:
- В начале игры у игрока 0 очков.
- Сбитые кегли прибавляются к счету игрока.
- Если за два последовательных броска игрок сбил в сумме 10 кеглей, то очки за следующий бросок удваиваются. Это называется «spare».
- Игра делится на 10 раундов (frames) по 2 броска в каждом. Сумма двух бросков для спейра учитывается только внутри раунда.
- Если игрок сбил все 10 кеглей за первый бросок в раунде, то два следующих броска удваиваются. Это называется «strike». Броски могут быть в разных раундах.
- Если в последнем ходе игрок получил *спейр*, то ему дается *один* дополнительных бросок. 
- Если в последнем ходе игрок получил *страйк*, то ему дается *два* дополнительных броска.
- Максимально можно выбить 300 очков бросив 10 страйков подряд. 

> Warning: попробуйте решить такую задачу без тестов. Чирикнуться можно!

Требования превращаются в простые тесты:

```swift
// MARK: - Spare
@Test func `when two rolls are 10 in sum should double next roll`() {
    spare(first: 4)

    roll(6)

    #expect(score == 10 + 6*2)
}

// MARK: - Strike
@Test func 'when strike should double score of next two rolls`() {
    strike()

    roll(4)
    roll(2)

    #expect(score == 16 + 4 + 2)
}

@Test func `when 3 strike in a row should double 2nd roll and triple 3rd`() {
    strike()
    strike()
    strike()

    #expect(score == 10 + 20 + 30)
}
```

> Tip: полный список тестов [в репозитории](https://github.com/akaDuality/BowlingKata/blob/master/BowlingTests/GameTests.swift)

> Tip: этот же подход можно использовать, чтобы научиться новому фреймворку для тестирования. [Пример тестов на Quick](https://github.com/akaDuality/BowlingKata/blob/Quick/BowlingTests/GameTests.swift) 

Другие  примеры задач можно найти на сайте https://kata-log.rocks/tdd. Советую попробовать самостоятельно решить несколько задач: так у вас появится десятки тестов и наработается насмотренность на состояние кода с тестами. 

Например, сделайте конвертер римских чисел опираясь, на табличку 
```
1 ➔ I
2 ➔ II
3 ➔ III
4 ➔ IV
5 ➔ V
9 ➔ IX
21 ➔ XXI
50 ➔ L
100 ➔ C
500 ➔ D
1000 ➔ M

MCMXCIV = 1000 + (1000 - 100) + (100 - 10) + (5 - 1) = 1994

```

## Туториал

- <doc:tutorials/BowlingKata>

## Принципы
Упражнение позволяет сфокусироваться на тестах, от этого получается отработать несколько удобных приемов:
- Тесты очень короткие и их легко писать. В будущем захочется все тесты держать в таком виде.
- Тест состоит из трех частей: arrange (подготовка), act (ключевое действие) и assert (проверка).
- Ассерты могут быть вычисляемыми, чтобы показывать логику подсчета
- В тестах появляется domain specific language (DSL) – специальный код, который упрощает написание тестов. В примере это функции `spare()` и `strike()`
- Тесты должны так описывать задачу, чтобы нужно было их минимально редактировать в процессе разработки.
- Тесты можно писать «снизу-вверх»: сначала ассерт, затем команду, которая приводит к результату, затем подготовку теста.

Именно из TDD-кат я черпал итоговое представление о тестах, которые мне нравятся. 
