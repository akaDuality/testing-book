# TDD-ката

Чтобы научиться писать тесты нужно поменять привычку того как вы обычно пишите код. Чтобы отработать навык можно поделать специальные упражнения, которые называют TDD-катами. Это простые задачки в которых главная цель научить себя сначала писать тесты, а потом уже писать код. 

> Note: слово «ката» пришло из карате и означает упражнение, которое надо делать регулярно, чтобы привыкнуть к движению. 

## Пример задачи

Типичная ката может быть сформулирована очень просто, например, «напишите расчет очков для игры в боулинг». Нужно разложить правила игры в требования и поочередно выполнить их, получится около 20 тестов. Пример требований:
- В начале игры у игрока 0 очков
- Сбитые кегли прибавляются к счету игрока
- Если за два последовательных хода игрок сбил в сумме 10 кеглей, то очки за следующий бросок удваиваются. Это называется «spare»
- Игра делится на 10 раундов по 2 броска. Сумма двух бросков учитывается только внутри раунда
- Если игрок сбил все 10 кеглей за первый бросок внутри раунда, то два следующих броска удваиваются. Это называется «strike».
- Если в последнем ходе игрок получил *спейр*, то ему дается *один* дополнительных ход
- Если в последнем ходе игрок получил *страйк*, то ему дается *два* дополнительных хода
- Максимально можно выбить 300 очков бросив 10 страйков подряд. 

В итоге такие требования превращаются в простые тесты:

```swift
// MARK: - Spare
@Test func whenTwoRollsAre10InSum_isSpare_thenNextRollScoredTwice() {
    spare(first: 4)

    game.roll(6)

    #expect(game.score == 10 + 6*2)
}

// MARK: - Strike
@Test func whenStrike_thenNextTwoRollsScoredTwice() {
    strike()

    game.roll(4)
    game.roll(2)

    #expect(game.score == 16 + 4 + 2)
}

@Test func when3StrikeInARow_FirstRollScores30Points_and2ndRollScored20Points() {
    strike()
    strike()
    strike()

    #expect(game.score == 130 + 20 + 10)
}
```

> Tip: полный список тестов [в репозитории](https://github.com/akaDuality/BowlingKata/blob/master/BowlingTests/GameTests.swift)

> Tip: этот же подход можно использовать, чтобы научиться новому фреймворку для тестирования. [Пример тестов на Quick](https://github.com/akaDuality/BowlingKata/blob/Quick/BowlingTests/GameTests.swift) 


На таких тестах можно отработать несколько необычных подходов:
- Тест состоит из трех частей: arrange, act, assert
- Тесты очень короткие и их легко писать. В будущем захочется все тесты держать в таком виде. 
- В тестах появляется domain specific language (DSL) – специальный код, который упрощает написание тестов. В примере это функции `spare()` и `strike()`
- Ассерты могут быть составными, чтобы показывать логику подсчета
- Вообще тесты можно писать снизу-вверх: сначала ассерт, затем команду, которая приводит к результату, затем подготовку теста


@Comment {
    // TODO: кастомные ассерты
}

@Comment {
    // TODO: Ссылка на туториал
}

@Comment {
    // TODO: Дать пару примеров других задач. 
}

> Warning: попробуйте решить такую задачу без тестов. Чирикнуться можно!

К концу такого упражнения очевидно, что тесты в реальном приложении такими красивыми не получатся, поэтому давайте разберемся в причинах этого. 
