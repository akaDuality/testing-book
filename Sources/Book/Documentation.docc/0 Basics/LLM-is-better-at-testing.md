# ИИ и тестирование

Напишет ли ИИ все тесты за нас? По большей части да, но нужна тестируемая архитектура.

## ИИ хорошо пишет простые тесты

По состоянию на начало 2025 года ИИ хорошо пишет базовые тесты:
- Сгенерирует ответ сети и подставит его в превью.
- Протестирует вьюмодель, сам придумает требования поверх текущего кода.
- Сгенерирует тестовые данные, например, разные даты.
- Отделит интерфейс, напишем мок и протестирует через него (и я так тестировать не советую).

> Note: ИИ склонен тестировать через моки. На мой вкус, это приводит к плохим тестам. Но есть и плюс: поддерживать такие тесты тоже будет ИИ.

Удобство еще и в том, что тесты описывают все требований, который год выполняет. Вместе с тем что тесты можно запустить и посмотреть проходят ли они — получается хорошая такая проверка для сгенерированного кода.

### ИИ может находить проблемы

Все мы обычные люди и даже «любители» тестов часто лишь закрепляют часть поведения. Создать полное описание требований к коду не получается, потому что это требует слишком много времени, ведь на одну функцию порой нужно несколько тестов. Но для ИИ это не проблема! Поэтому я часто наталкиваюсь на такой сценарий: ИИ генерирует так много тестов, что часть из них реально находят баги!

Но к такому состоянию можно прийти только если архитектура проекта позволяет ИИ написать любой нужный тест. 

### ИИ не создаст тестируемую архитектуру за вас

ИИ плохо создает архитектурные требования, вы явно должны ему объяснить какой конечный результат вы хотите. Получается, что ваша «человеческая» задача состоит в том, чтобы заложить тестируемую архитектуру и объяснить правила тестирования, а уже поверх нее получится генерировать нормальные тесты.   

Что входит в мое понимание тестируемой архитектуры:
- Модульность приложения, чтобы тесты можно было запустить лишь для части проекта. Т.е. приложение делится на пакеты/фреймворки/библиотеки. 
- Выделены ключевые зависимости проекта: сеть, роутинг, аналитика, внешние библиотеки. Такие зависимости можно подменить в тестах и задать нужное поведение.  
- Есть коллекция стабов сети, которая позволяет легко подменить ответы от бэкенда и привести код к нужному состоянию. 
- Есть «хелперы», которые позволяют упростить работу с отдельными экранами. 

Задача книги — показать вам, что нужно сделать, чтобы получить контроль над всем проектом и описать правила по которым ИИ будет автоматизировать проверки.

### Тестирование через сценарии

В тестировании есть много разных подходов. Чаще всего можно столкнуться с **тестированием в максимальной изоляции, т.е. через моки**: создавать для каждого класса интерфейс, мокать зависимости класса, писать тесты на отдельные классы. В итоге мы как-бы атомарно все протестировали, но как работает система в целом сказать сложно. При этом мы чаще тестируем «поведение класса»: какие соседние классы он вызвал, какие данные передал. Задачи при разработке редко сводится к изменению в одном классе, поэтому мне такой подход не нравится: слишком много тестового кода, слишком хрупкие тесты ломаются после рефакторинга. С ИИ их стало проще поддерживать, но это не делает сами тесты лучше. По-умолчанию ИИ пишет именно такие тесты. 

Есть подход который **тестирует состояние**: при тестировании нужно найти такие объекты, которые представляют собой результат работы программы. Обычно такие тесты охватывают уже несколько классов, от этого получаются более устойчивыми к рефакторингу. В iOS есть хорошие библиотеки для снепшота данных, поэтому работать через такой подход  чуть легче. 

Мне ближе подход «через сценарии», когда в тестах мы описываем реальную бизнес-задачу, тестируем через внешние зависимости для модуля, а какие там классы решают эту задачу, как они связаны между собой и т.п. вообще не должно быть видно в тестах. Так нужно написать меньше тестов, их легче поддерживать, но их сложнее писать. В книге я покажу какими способами я делаю их написание не сложным, а интересным.   

### Порядок действий для ИИ чтобы написать тест сценария

В конце мы получим примерной такой порядок действий для ИИ:
- Выделить зависимости и обернуть в Dependency
- Создать стаб сетевого ответа в функции `testMake()`.
- Описать навигацию внутри экрана и между экранами через CasePathable
- Написать вспомогательные функции для вьюмоделей/других классов.
- И вот тут уже получится написать тест на сценарий из нескольких экранов.

В книге разберем кажды шаг подробно. Начнем с тестирование вьюмоделей и экранов, а потом разберемся с навигацией и описанием сценариев.
