# Скриншот-тестирование

Многие для своей работы используют SwiftUI-Preview, чтобы ускорить верстку. Поверх превью легко сделать скриншот-тесты, которые смогут добавить большое количество проверок к вашим вьюшкам: темную тему, Dynamic Type и даже озвучивание скринридера. 


## UI тестировать сложно

Большая часть мобильного приложения это графический интерфейс. При этом интерфейс запускается в разном окружении: у телефонов разный размер экрана, вечером надо включить темную тему, в арабских странах написание текста справа-налево, некоторые люди увеличивают размер шрифта, а незрячие вообще все это не видят и для них интерфейс должен быть озвучен. 

Буквально для одной надписи у нас может быть куча состояний, которые будут значительно влиять на верстку.

@Image(source: single-label-problem)

## Что можно тестировать через скриншот-тесты

### Компоненты дизайн-системы

Самое простое что мы можем сделать в начале: закрепить состояния контролов в дизайн-системе в разных размерах и состояниях. 

@Image(source: design-system-buttons) {
    Все виды кнопок Jazari в разных размерах и состояниях. На скриншоте можно найти баги :-)
}

### Ячейки

Даже в несложных ячейках может быть большое количество состояний. 

@Image(source: screenshot-samples) {
    Даже для одной ячейки может может быть огромное количество вариантов
}

@Comment {
    альтернативная картинка
    @Image(source: SnapshotResults)
}

### Целые экраны

Можно тестировать целый экран. Иногда экран простой, но может сильно меняться от Dynamic Type или страны. 

@Image(source: screenshots-of-screen) {
    Целый экран может быть компонентом дизайн-системы
}

Можно тестировать экран в разных состояниях загрузки. Важнее всего показать ошибку, потому что при ручных проверках мы с ней сталкиваемся намного реже. 

@Image(source: screen-states) {
    Состояния экрана: загрузка, данные, ошибка 
}

Экран может иметь большое количество внутренних состояний. Например, экран доставки. Чтобы протестировать все состояния вручную надо будет создать кучу заказов. 

@Image(source: delivery-states)


### Визуальное тестирование невизуальной информации

Больше всего мне нравится как снепшоты могут менять привычное представление о тестировании. Например, для поддержки скринридера надо бы как-то тестировать как *озвучиваются* все экраны для незрячего. Как же это можно сделать? Решение изящное: мы можем брать текст, который читает скринридер и добавлять его к скриншоту. Еще и цветом покажем какой элемнет где подписан и как рамка фокуса на него встает. 

> Tip: Скриншот показывает то, что будет озвучено для незрячего!

@Image(source: voice-over-screenshot) {
    Слева нет подписи для поле с емейлом. Справа исправленный скриншот: изменилась и рамка фокуса и текст снизу
}


## Скриншот-тесты покажут влияние дизайн-системы

Все строят дизайн-системы, чтобы можно было в одном месте поменять стиль кнопочки, а применилось ко всему проекту. Идеальная схема, в которой есть важная проблема:

>Note: легко поменять компонент, но сложно проверить все места, на которые он повлиял. 

@Image(source: design-system)

Сохраняя снимки как отдельных компонентов, так и целых экранов мы получаем «хрупкость» тестов, потому что изменения в дизайн-системе будут влиять на многие картинки, но так мы можем увидеть как наши изменения повлияли на все экраны. А это ровно цель ускорения фидбека через тестирование.  

Удивительно, что Фигма ничего не делает с этой стороны. Но разобраться можно на уровне кода через скриншот-тесты: если у вас есть живые снимки всех экранов, то при изменении стиля вы увидите все изменения, стоит лишь тесты запустить.

Ща разберемся как это быстро накрутить.

@Image(source: KeynoteAlert) {
    Keynote понимает проблему обновления переиспользуемого стиля, но не пытается показать все места с изменениями
}
    
### Доступ ко всем экранам

В долгих проектах порой надо не только протестировать, но и вообще оценить в каких состояниях у нас сейчас все экраны. Например, мы хотим передизайнить как сейчас выглядит регистрация пользователя в банке. Для дизайнера задача начинается с того, что ему нужно найти все текущие экраны, чтобы понять задачу, а команде правильно оценить объем работ. Как это сделать быстро? Можно через скриншот-тесты, когда у вас есть все актуальные картинки, а можно через встроенный в приложение плейбук. 

@Image(source: onboarding-playbook)

@Comment {
    Раскрыть про плейбуки
}
