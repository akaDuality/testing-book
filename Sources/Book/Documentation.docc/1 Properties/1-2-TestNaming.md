# Не пишите юнит-тесты, а пишите...

Неправильный нейминг тестов увел разрабочтиков не в том направлении. Давайте отталкиваться от свойств кода, а не типов тестов.


## Overview

Тесты надо измерять по двум критериями:
- Насколько много кода они охватывают
- Насколько стабильны их зависимости. 

Нейминг юнит/интеграционные тесты мешает вам написать хорошие тесты. 


## Проблемы нейминга. 

В книгах про тестирование упоминаются два вида тестов. 
- Юнит-тесты: тестируют небольшой кусочек кода. Очень точные. 
- Интеграционные тесты: тестируют всю системы в связке, чтобы проверить общую работоспособность. 

Такой нейминг не подходит для мобильной разработки, потому что порождает много вопросов и проблем. 

- Юнит-тест это когда тест на одну функцию? Кажется, что если тестировать целый класс, то это все еще юнит-тест, а вот если взять парочку классов в связке, то это уже не юнит-тест. Значит, надо тестировать все классы по-отдельности? (Нет конечно)
- Раз мы тестируем все классы в изоляции, то их друг от друга надо отделить протоколами и на все «зависимости» написать стабы. Это сликком много работы, подключим кодогенерацию. Ой, компилироваться стало тоже медленее. Ой, рефакторить такое тоже сложно. Ну вот и не будем писать юнит-тесты, потому что они безсполезны
- Интеграционные тесты это когда тесты в сеть ходят? Тогда UI-тесты это интеграционые? А если я тестирую несколько классов вместе, но сеть замокал, то это тоже интеграционые? 
- А может мы тогда UI-тесты назовем end-to-end тестами, а интеграциоонными вообще ничего не будем называть? Раз мы их не называем, то и писать их тоже не будем. 
- UI-тесты пусть QA пишут, все равно там другой фреймворк. Да и медленные они
- Ой, UI-тесты не работают, потому что разработчики что-то вчера сломали, а тесты запускаются по ночам. Мы не знаем где проблема, но все красное. 

> Warning: хоспади, какое это все говно



## Какие свойства тестов важны

Давайте начнем сначала и разберемся какие свойства тестов нам важны. 

### Скорость
Тесты должны быть быстрыми, чтобы их было легко и приятно запускать и от этого код тестировался бы почаще, да хоть после каждого изменения. При этом не скорость теста не влияет количество классов которые вы тестируете, важен лишь объем данных которые вы прогоняете через этот код и насколько быстро работают реальные внешние зависимости: сеть, диск, время, настройки телефона и т.п. 

Да вы можете даже конвертацию видео в 0 секунд прогнать через ваши тесты: сработает весь код, но он все равно будет быстрый, потому что данных мало. 

> Tip: тест может охватывать сколько угодно объектов пока он выполняется быстро.

> Note: Конечно удобно, когда все важные свойства сошлись в одном классе и все тесты написаны на этот класс, но это свойство вашей архитектуры, а не теста!


### Стабильность
Не получится написать стабильный тест, который ходит за данными в интернет: то сеть моргнет, то сервер выключится, то Роскомнадзор учения проведет. Это мешает вашей работе, поэтому хорошо бы убрать эту неопределенность из тестов. 

Если вы вынесли все переменны из кода и их значение не меняется случайно внутри вашего кода, то его выполнение будет строго определено. Получается, что все переменные штуки надо от кода явно отделить и уметь их контролировать.  

> Tip: тест должен быть стабилен, для этого надо отделить стабильную логику от нестабильной инфраструктуры.


### Живучесть

Тесты должны переживать рефакторинг и служить вам долго, чтобы вы уделяли им как можно меньше времени и получали больше пользы. Код меняется часто, а вот бизнес-требования меняются сильно реже, поэтому:

> Tip: тесты должны отражать бизнес-требования, а не вызовы ваших классов.     


## Постепенное повышение качества тестов

Конечно, хочется сразу написать тесты которые подходят под эти требования, но скорее всего вам нужно что-то попроще. 

- Забейте на скорость тестов: оптимизируете вы попозже, когда задачу хоть как-то решите
- Пишите тесты относительно реального бэкенда, потому что вам важно знать как он работает и что отдает. По мере того как он будет становиться стабильней уточняйте тесты. 
- Не отделяйте зависимости раньше времени и тестируйте прямо с ними: вы увидите все причины нестабильности и сможете потом их обработать
- Пишите такие тесты, которые помогают сейчас. Не надо будет — выкинете, они свое отработали. 

Но все эти исключения можно сформулировать иначе:

> Tip: Начинайте с тестов на сценарии, а потом улучшайте как получится. 

Так вы сможете написать минимум тестов, получить максимум пользы, а потом детализировать разные места по-необходимости. 

@Comment {
    // TODO: Тут очень просится иллюстрация. 
}



